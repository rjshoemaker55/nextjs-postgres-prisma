{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _this = this,\n    _jsxFileName = \"/Users/rjshoemaker/Documents/code/practice/nextjs-postgres-prisma/blogr-nextjs-prisma/pages/p/[id].tsx\",\n    _s = $RefreshSig$();\n\nimport _JSXStyle from \"styled-jsx/style\";\nvar __jsx = React.createElement;\nimport React from 'react';\nimport ReactMarkdown from 'react-markdown';\nimport Layout from '../../components/Layout';\nimport Router from 'next/router';\nimport { useSession } from 'next-auth/client';\n\nfunction publishPost(_x) {\n  return _publishPost.apply(this, arguments);\n}\n\nfunction _publishPost() {\n  _publishPost = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(id) {\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.next = 2;\n            return fetch('http://localhost:3000/api/publish/${id}', {\n              method: 'PUT'\n            });\n\n          case 2:\n            _context.next = 4;\n            return Router.push('/');\n\n          case 4:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n  return _publishPost.apply(this, arguments);\n}\n\nvar Post = function Post(props) {\n  _s();\n\n  var _session$user, _props$author, _session$user2, _props$author2, _props$author3;\n\n  var _useSession = useSession(),\n      _useSession2 = _slicedToArray(_useSession, 2),\n      session = _useSession2[0],\n      loading = _useSession2[1];\n\n  if (loading) {\n    return __jsx(\"div\", {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 35,\n        columnNumber: 12\n      }\n    }, \"Authenticating...\");\n  }\n\n  var userHasValidSession = Boolean(session);\n  console.log(session === null || session === void 0 ? void 0 : (_session$user = session.user) === null || _session$user === void 0 ? void 0 : _session$user.email, (_props$author = props.author) === null || _props$author === void 0 ? void 0 : _props$author.email);\n  console.log(props);\n  var postBelongsToUser = (session === null || session === void 0 ? void 0 : (_session$user2 = session.user) === null || _session$user2 === void 0 ? void 0 : _session$user2.email) === ((_props$author2 = props.author) === null || _props$author2 === void 0 ? void 0 : _props$author2.email);\n  console.log(!props.published, userHasValidSession, postBelongsToUser);\n  var title = props.title;\n\n  if (!props.published) {\n    title = \"\".concat(title, \" (Draft)\");\n  }\n\n  return __jsx(Layout, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 50,\n      columnNumber: 5\n    }\n  }, __jsx(\"div\", {\n    className: \"jsx-3440979688\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 51,\n      columnNumber: 7\n    }\n  }, __jsx(\"h2\", {\n    className: \"jsx-3440979688\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 52,\n      columnNumber: 9\n    }\n  }, title), __jsx(\"p\", {\n    className: \"jsx-3440979688\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 53,\n      columnNumber: 9\n    }\n  }, \"By \", (props === null || props === void 0 ? void 0 : (_props$author3 = props.author) === null || _props$author3 === void 0 ? void 0 : _props$author3.name) || 'Unknown author'), __jsx(ReactMarkdown, {\n    source: props.content,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 55,\n      columnNumber: 9\n    }\n  }), !props.published && userHasValidSession && postBelongsToUser && __jsx(\"button\", {\n    onClick: function onClick() {\n      return publishPost(props.id);\n    },\n    className: \"jsx-3440979688\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 58,\n      columnNumber: 11\n    }\n  }, \"Publish\")), __jsx(_JSXStyle, {\n    id: \"3440979688\",\n    __self: _this\n  }, \".page.jsx-3440979688{background:white;padding:2rem;}.actions.jsx-3440979688{margin-top:2rem;}button.jsx-3440979688{background:#ececec;border:0;border-radius:0.125rem;padding:1rem 2rem;}button.jsx-3440979688+button.jsx-3440979688{margin-left:1rem;}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9yanNob2VtYWtlci9Eb2N1bWVudHMvY29kZS9wcmFjdGljZS9uZXh0anMtcG9zdGdyZXMtcHJpc21hL2Jsb2dyLW5leHRqcy1wcmlzbWEvcGFnZXMvcC9baWRdLnRzeCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUE0RGtCLEFBRzRCLEFBS0QsQUFJRyxBQU9GLGdCQVZuQixDQUxlLEFBZ0JmLEVBUFcsU0FDYyxFQVR6QixxQkFVb0Isa0JBQ3BCIiwiZmlsZSI6Ii9Vc2Vycy9yanNob2VtYWtlci9Eb2N1bWVudHMvY29kZS9wcmFjdGljZS9uZXh0anMtcG9zdGdyZXMtcHJpc21hL2Jsb2dyLW5leHRqcy1wcmlzbWEvcGFnZXMvcC9baWRdLnRzeCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCdcbmltcG9ydCB7IEdldFNlcnZlclNpZGVQcm9wcyB9IGZyb20gJ25leHQnXG5pbXBvcnQgUmVhY3RNYXJrZG93biBmcm9tICdyZWFjdC1tYXJrZG93bidcbmltcG9ydCBMYXlvdXQgZnJvbSAnLi4vLi4vY29tcG9uZW50cy9MYXlvdXQnXG5pbXBvcnQgeyBQb3N0UHJvcHMgfSBmcm9tICcuLi8uLi9jb21wb25lbnRzL1Bvc3QnXG5pbXBvcnQgcHJpc21hIGZyb20gJy4uLy4uL2xpYi9wcmlzbWEnXG5pbXBvcnQgUm91dGVyIGZyb20gJ25leHQvcm91dGVyJ1xuaW1wb3J0IHsgdXNlU2Vzc2lvbiB9IGZyb20gJ25leHQtYXV0aC9jbGllbnQnXG5cbmV4cG9ydCBjb25zdCBnZXRTZXJ2ZXJTaWRlUHJvcHM6IEdldFNlcnZlclNpZGVQcm9wcyA9IGFzeW5jICh7IHBhcmFtcyB9KSA9PiB7XG4gIGNvbnN0IHBvc3QgPSBhd2FpdCBwcmlzbWEucG9zdC5maW5kVW5pcXVlKHtcbiAgICB3aGVyZTogeyBpZDogTnVtYmVyKHBhcmFtcz8uaWQpIHx8IC0xIH0sXG4gICAgaW5jbHVkZToge1xuICAgICAgYXV0aG9yOiB7XG4gICAgICAgIHNlbGVjdDogeyBuYW1lOiB0cnVlLCBlbWFpbDogdHJ1ZSB9XG4gICAgICB9XG4gICAgfVxuICB9KVxuICByZXR1cm4ge1xuICAgIHByb3BzOiBwb3N0XG4gIH1cbn1cblxuYXN5bmMgZnVuY3Rpb24gcHVibGlzaFBvc3QoaWQ6IG51bWJlcik6IFByb21pc2U8dm9pZD4ge1xuICBhd2FpdCBmZXRjaCgnaHR0cDovL2xvY2FsaG9zdDozMDAwL2FwaS9wdWJsaXNoLyR7aWR9Jywge1xuICAgIG1ldGhvZDogJ1BVVCdcbiAgfSlcblxuICBhd2FpdCBSb3V0ZXIucHVzaCgnLycpXG59XG5cbmNvbnN0IFBvc3Q6IFJlYWN0LkZDPFBvc3RQcm9wcz4gPSAocHJvcHMpID0+IHtcbiAgY29uc3QgW3Nlc3Npb24sIGxvYWRpbmddID0gdXNlU2Vzc2lvbigpXG4gIGlmIChsb2FkaW5nKSB7XG4gICAgcmV0dXJuIDxkaXY+QXV0aGVudGljYXRpbmcuLi48L2Rpdj5cbiAgfVxuICBjb25zdCB1c2VySGFzVmFsaWRTZXNzaW9uID0gQm9vbGVhbihzZXNzaW9uKVxuICBjb25zb2xlLmxvZyhzZXNzaW9uPy51c2VyPy5lbWFpbCwgcHJvcHMuYXV0aG9yPy5lbWFpbClcbiAgY29uc29sZS5sb2cocHJvcHMpXG4gIGNvbnN0IHBvc3RCZWxvbmdzVG9Vc2VyID0gc2Vzc2lvbj8udXNlcj8uZW1haWwgPT09IHByb3BzLmF1dGhvcj8uZW1haWxcblxuICBjb25zb2xlLmxvZyghcHJvcHMucHVibGlzaGVkLCB1c2VySGFzVmFsaWRTZXNzaW9uLCBwb3N0QmVsb25nc1RvVXNlcilcblxuICBsZXQgdGl0bGUgPSBwcm9wcy50aXRsZVxuICBpZiAoIXByb3BzLnB1Ymxpc2hlZCkge1xuICAgIHRpdGxlID0gYCR7dGl0bGV9IChEcmFmdClgXG4gIH1cblxuICByZXR1cm4gKFxuICAgIDxMYXlvdXQ+XG4gICAgICA8ZGl2PlxuICAgICAgICA8aDI+e3RpdGxlfTwvaDI+XG4gICAgICAgIDxwPkJ5IHtwcm9wcz8uYXV0aG9yPy5uYW1lIHx8ICdVbmtub3duIGF1dGhvcid9PC9wPlxuXG4gICAgICAgIDxSZWFjdE1hcmtkb3duIHNvdXJjZT17cHJvcHMuY29udGVudH0gLz5cblxuICAgICAgICB7IXByb3BzLnB1Ymxpc2hlZCAmJiB1c2VySGFzVmFsaWRTZXNzaW9uICYmIHBvc3RCZWxvbmdzVG9Vc2VyICYmIChcbiAgICAgICAgICA8YnV0dG9uIG9uQ2xpY2s9eygpID0+IHB1Ymxpc2hQb3N0KHByb3BzLmlkKX0+UHVibGlzaDwvYnV0dG9uPlxuICAgICAgICApfVxuICAgICAgPC9kaXY+XG4gICAgICA8c3R5bGUganN4PntgXG4gICAgICAgIC5wYWdlIHtcbiAgICAgICAgICBiYWNrZ3JvdW5kOiB3aGl0ZTtcbiAgICAgICAgICBwYWRkaW5nOiAycmVtO1xuICAgICAgICB9XG5cbiAgICAgICAgLmFjdGlvbnMge1xuICAgICAgICAgIG1hcmdpbi10b3A6IDJyZW07XG4gICAgICAgIH1cblxuICAgICAgICBidXR0b24ge1xuICAgICAgICAgIGJhY2tncm91bmQ6ICNlY2VjZWM7XG4gICAgICAgICAgYm9yZGVyOiAwO1xuICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDAuMTI1cmVtO1xuICAgICAgICAgIHBhZGRpbmc6IDFyZW0gMnJlbTtcbiAgICAgICAgfVxuXG4gICAgICAgIGJ1dHRvbiArIGJ1dHRvbiB7XG4gICAgICAgICAgbWFyZ2luLWxlZnQ6IDFyZW07XG4gICAgICAgIH1cbiAgICAgIGB9PC9zdHlsZT5cbiAgICA8L0xheW91dD5cbiAgKVxufVxuXG5leHBvcnQgZGVmYXVsdCBQb3N0XG4iXX0= */\\n/*@ sourceURL=/Users/rjshoemaker/Documents/code/practice/nextjs-postgres-prisma/blogr-nextjs-prisma/pages/p/[id].tsx */\"));\n};\n\n_s(Post, \"btnbnkOsPYI0mLfZro/2DT47AuA=\", false, function () {\n  return [useSession];\n});\n\n_c = Post;\nexport var __N_SSP = true;\nexport default Post;\n\nvar _c;\n\n$RefreshReg$(_c, \"Post\");","map":{"version":3,"sources":["/Users/rjshoemaker/Documents/code/practice/nextjs-postgres-prisma/blogr-nextjs-prisma/pages/p/[id].tsx"],"names":["React","ReactMarkdown","Layout","Router","useSession","publishPost","id","fetch","method","push","Post","props","session","loading","userHasValidSession","Boolean","console","log","user","email","author","postBelongsToUser","published","title","name","content"],"mappings":";;;;;;;;;;AAAA,OAAOA,KAAP,MAAkB,OAAlB;AAEA,OAAOC,aAAP,MAA0B,gBAA1B;AACA,OAAOC,MAAP,MAAmB,yBAAnB;AAGA,OAAOC,MAAP,MAAmB,aAAnB;AACA,SAASC,UAAT,QAA2B,kBAA3B;;SAgBeC,W;;;;;0EAAf,iBAA2BC,EAA3B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBACQC,KAAK,CAAC,yCAAD,EAA4C;AACrDC,cAAAA,MAAM,EAAE;AAD6C,aAA5C,CADb;;AAAA;AAAA;AAAA,mBAKQL,MAAM,CAACM,IAAP,CAAY,GAAZ,CALR;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;;;AAQA,IAAMC,IAAyB,GAAG,SAA5BA,IAA4B,CAACC,KAAD,EAAW;AAAA;;AAAA;;AAAA,oBAChBP,UAAU,EADM;AAAA;AAAA,MACpCQ,OADoC;AAAA,MAC3BC,OAD2B;;AAE3C,MAAIA,OAAJ,EAAa;AACX,WAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,2BAAP;AACD;;AACD,MAAMC,mBAAmB,GAAGC,OAAO,CAACH,OAAD,CAAnC;AACAI,EAAAA,OAAO,CAACC,GAAR,CAAYL,OAAZ,aAAYA,OAAZ,wCAAYA,OAAO,CAAEM,IAArB,kDAAY,cAAeC,KAA3B,mBAAkCR,KAAK,CAACS,MAAxC,kDAAkC,cAAcD,KAAhD;AACAH,EAAAA,OAAO,CAACC,GAAR,CAAYN,KAAZ;AACA,MAAMU,iBAAiB,GAAG,CAAAT,OAAO,SAAP,IAAAA,OAAO,WAAP,8BAAAA,OAAO,CAAEM,IAAT,kEAAeC,KAAf,yBAAyBR,KAAK,CAACS,MAA/B,mDAAyB,eAAcD,KAAvC,CAA1B;AAEAH,EAAAA,OAAO,CAACC,GAAR,CAAY,CAACN,KAAK,CAACW,SAAnB,EAA8BR,mBAA9B,EAAmDO,iBAAnD;AAEA,MAAIE,KAAK,GAAGZ,KAAK,CAACY,KAAlB;;AACA,MAAI,CAACZ,KAAK,CAACW,SAAX,EAAsB;AACpBC,IAAAA,KAAK,aAAMA,KAAN,aAAL;AACD;;AAED,SACE,MAAC,MAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAKA,KAAL,CADF,EAEE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,YAAO,CAAAZ,KAAK,SAAL,IAAAA,KAAK,WAAL,8BAAAA,KAAK,CAAES,MAAP,kEAAeI,IAAf,KAAuB,gBAA9B,CAFF,EAIE,MAAC,aAAD;AAAe,IAAA,MAAM,EAAEb,KAAK,CAACc,OAA7B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAJF,EAMG,CAACd,KAAK,CAACW,SAAP,IAAoBR,mBAApB,IAA2CO,iBAA3C,IACC;AAAQ,IAAA,OAAO,EAAE;AAAA,aAAMhB,WAAW,CAACM,KAAK,CAACL,EAAP,CAAjB;AAAA,KAAjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,eAPJ,CADF;AAAA;AAAA;AAAA,8tHADF;AAmCD,CApDD;;GAAMI,I;UACuBN,U;;;KADvBM,I;;AAsDN,eAAeA,IAAf","sourcesContent":["import React from 'react'\nimport { GetServerSideProps } from 'next'\nimport ReactMarkdown from 'react-markdown'\nimport Layout from '../../components/Layout'\nimport { PostProps } from '../../components/Post'\nimport prisma from '../../lib/prisma'\nimport Router from 'next/router'\nimport { useSession } from 'next-auth/client'\n\nexport const getServerSideProps: GetServerSideProps = async ({ params }) => {\n  const post = await prisma.post.findUnique({\n    where: { id: Number(params?.id) || -1 },\n    include: {\n      author: {\n        select: { name: true, email: true }\n      }\n    }\n  })\n  return {\n    props: post\n  }\n}\n\nasync function publishPost(id: number): Promise<void> {\n  await fetch('http://localhost:3000/api/publish/${id}', {\n    method: 'PUT'\n  })\n\n  await Router.push('/')\n}\n\nconst Post: React.FC<PostProps> = (props) => {\n  const [session, loading] = useSession()\n  if (loading) {\n    return <div>Authenticating...</div>\n  }\n  const userHasValidSession = Boolean(session)\n  console.log(session?.user?.email, props.author?.email)\n  console.log(props)\n  const postBelongsToUser = session?.user?.email === props.author?.email\n\n  console.log(!props.published, userHasValidSession, postBelongsToUser)\n\n  let title = props.title\n  if (!props.published) {\n    title = `${title} (Draft)`\n  }\n\n  return (\n    <Layout>\n      <div>\n        <h2>{title}</h2>\n        <p>By {props?.author?.name || 'Unknown author'}</p>\n\n        <ReactMarkdown source={props.content} />\n\n        {!props.published && userHasValidSession && postBelongsToUser && (\n          <button onClick={() => publishPost(props.id)}>Publish</button>\n        )}\n      </div>\n      <style jsx>{`\n        .page {\n          background: white;\n          padding: 2rem;\n        }\n\n        .actions {\n          margin-top: 2rem;\n        }\n\n        button {\n          background: #ececec;\n          border: 0;\n          border-radius: 0.125rem;\n          padding: 1rem 2rem;\n        }\n\n        button + button {\n          margin-left: 1rem;\n        }\n      `}</style>\n    </Layout>\n  )\n}\n\nexport default Post\n"]},"metadata":{},"sourceType":"module"}